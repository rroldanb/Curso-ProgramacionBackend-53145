<main>
  <div class="bienvenida">
    <h1>Bienvenido a nuestro e-commerce</h1>
    <h2>Aquí puedes Restablecer tu Contraseña</h2>
  </div>

  <div class="container d-flex flex-row w-20">
    <form id="resetPasswordForm" class="bg-primary-subtle p-4 rounded" method="POST" action="/auth/reset-password" >
      <input type="hidden" name="token" value="{{token}}" />
        <div class="mb-3">
            <div class="form-group">
            <label for="newPassword"class="form-label">Nueva Contraseña</label>
            <div class="input-group">

            <input type="password" placeholder="" name="newPassword" id="newPassword" class="form-control toggle-password" required>
              <button class="btn btn-outline-secondary toggle-password-btn" type="button">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            </div>
            <div class="form-group mt-4">
            <label for="confirmPassword"class="form-label">Confirmar Nueva Contraseña</label>
            <div class="input-group">

            <input type="password" placeholder="" name="confirmPassword" id="confirmPassword" class="form-control toggle-password" required>
              <button class="btn btn-outline-secondary toggle-password-btn" type="button">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            </div>
        </div>
      {{!-- <div class="form-group">
        <label for="newPassword">Nueva Contraseña</label>
        <input type="password" name="newPassword" id="newPassword" class="form-control" required>
      </div> --}}
      {{!-- <div class="form-group">
        <label for="confirmPassword">Confirmar Nueva Contraseña</label>
        <input type="password" name="confirmPassword" id="confirmPassword" class="form-control" required>
      </div> --}}
      <div class="flex mt-4">
        <a href="/" class="btn btn-secondary" id="btn-chat">Ir al Inicio <i class="bi bi-house"></i></a>
        <button type="submit" class="btn btn-primary">Restablecer Contraseña <i class="bi bi-check-lg"></i></button>
      </div>
    </form>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>

<script>

    document.querySelectorAll(".toggle-password-btn").forEach((button) => {
  button.addEventListener("click", function () {
    const input = this.previousElementSibling;
    const icon = this.querySelector("i");

    if (input.type === "password") {
      input.type = "text";
      icon.classList.remove("bi-eye");
      icon.classList.add("bi-eye-slash");
    } else {
      input.type = "password";
      icon.classList.remove("bi-eye-slash");
      icon.classList.add("bi-eye");
    }
  });
});
  document.getElementById('resetPasswordForm').addEventListener('submit', async function(event) {
    event.preventDefault(); 
      var newPassword = document.getElementById('newPassword').value;
      var confirmPassword = document.getElementById('confirmPassword').value;

      if (newPassword !== confirmPassword) {
        event.preventDefault();
//        alert('Las contraseñas no coinciden. Por favor, intente nuevamente.');
        Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Las contraseñas no coinciden. Por favor, intente nuevamente.',
        confirmButtonText: 'Aceptar'
        });
        return
      }
      
    
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    try {
      const response = await fetch(form.action, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        Swal.fire({
          icon: 'success',
          title: 'Éxito',
          text: result.message,
          confirmButtonText: 'Aceptar'
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: result.message,
          confirmButtonText: 'Aceptar'
        });
      }
    } catch (error) {
    console.log(error)
      console.error('Error al enviar la solicitud:', error);
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Hubo un problema al intentar restablecer la contraseña. Por favor, intenta de nuevo más tarde.',
        confirmButtonText: 'Aceptar'
      });
    }
  });
</script>
